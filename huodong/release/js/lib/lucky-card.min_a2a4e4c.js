!function(t,e){"use strict";function i(t,e){this.cover=null,this.ctx=null,this.scratchDiv=null,this.cardDiv=null,this.cHeight=0,this.cWidth=0,this.supportTouch=!1,this.events=[],this.startEventHandler=null,this.moveEventHandler=null,this.endEventHandler=null,this.opt={coverColor:"#C5C5C5",coverImg:"",ratio:.8,callback:null,strokes:10},this.init(t,e)}function n(t,e,i){var n=t.getImageData(0,0,300,100),s=[];o(n.data,function(t,e){var i=n.data[e+3];0===i&&s.push(i)}),s.length/n.data.length>i&&e&&"function"==typeof e&&e()}function o(t,e){return Array.prototype.forEach.call(t,function(t,i){e(t,i)})}function s(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}function c(t){this.moveEventHandler=h.bind(this),this.cover.addEventListener(this.events[1],this.moveEventHandler,!1),this.endEventHandler=r.bind(this),e.addEventListener(this.events[2],this.endEventHandler,!1),t.preventDefault()}function h(t){var i=this.supportTouch?t.touches[0]:t,n=this.cover.getBoundingClientRect(),o=e.documentElement.scrollTop||e.body.scrollTop,s=e.documentElement.scrollLeft||e.body.scrollLeft,c=i.pageX-n.left-s,h=i.pageY-n.top-o,r=this.opt.strokes;this.ctx.beginPath(),this.ctx.fillStyle="#FFFFFF",this.ctx.globalCompositeOperation="destination-out",this.ctx.arc(c,h,r,0,2*Math.PI),this.ctx.fill(),t.preventDefault()}function r(t){this.opt.callback&&"function"==typeof this.opt.callback&&n(this.ctx,this.opt.callback,this.opt.ratio),this.cover.removeEventListener(this.events[1],this.moveEventHandler,!1),e.removeEventListener(this.events[2],this.endEventHandler,!1),t.preventDefault()}i.prototype.createCanvas=function(){if(this.cover=e.createElement("canvas"),this.cover.id="cover",this.cover.height=this.cHeight,this.cover.width=this.cWidth,this.ctx=this.cover.getContext("2d"),this.opt.coverImg){var t=this,i=new Image;i.src=this.opt.coverImg,i.onload=function(){t.ctx.drawImage(i,0,0,t.cover.width,t.cover.height)}}else this.ctx.fillStyle=this.opt.coverColor,this.ctx.fillRect(0,0,this.cover.width,this.cover.height);this.scratchDiv.appendChild(this.cover)},i.prototype.eventDetect=function(){"ontouchstart"in t&&(this.supportTouch=!0),this.events=this.supportTouch?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],this.addEvent()},i.prototype.addEvent=function(){this.startEventHandler=c.bind(this),this.cover.addEventListener(this.events[0],this.startEventHandler,!1)},i.prototype.clearCover=function(){this.ctx.clearRect(0,0,this.cover.width,this.cover.height)},i.prototype.init=function(){if(!s())return void alert("对不起，当前浏览器不支持Canvas，无法使用本控件！");var t=this;o(arguments,function(e){if("object"==typeof e)for(var i in e)"callback"===i&&"function"==typeof e[i]?t.opt.callback=e[i].bind(t):i in t.opt&&(t.opt[i]=e[i]);else"function"==typeof e&&(t.opt.callback=e.bind(t))}),this.scratchDiv=e.getElementById("scratch"),this.cardDiv=e.getElementById("card"),this.scratchDiv&&this.cardDiv&&(this.cHeight=this.cardDiv.clientHeight,this.cWidth=this.cardDiv.clientWidth,this.createCanvas(),this.eventDetect())},i.case=function(t,e){return new i(t,e)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?(module.exports=i.case,module.exports.LuckyCard=i):t.LuckyCard=i}(window,document);