var Bridge={platform:navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Linux")>-1||navigator.userAgent.indexOf("android")>-1?"android":"ios",commandQueue:[],callQueueId:0,osEventCallback:{},callbackId:1,callbackCache:{},pushCallback:function(e){return"function"==typeof e?(this.callbackCache[this.callbackId]=e,this.callbackId++):0},applyCallback:function(e){var t=this.callbackCache[e];if("function"==typeof t){var i=Array.prototype.slice.call(arguments,1);return t.apply(null,i)}},popCallback:function(e){var t=this.callbackCache[e];return"function"==typeof t?(delete this.callbackCache[e],t):void 0},exec:function(e,t){for(var i=[],n=2;n<arguments.length;n++)i.push(arguments[n]);if("android"==this.platform){var o=!0;if(window.os&&window.os.notify)try{var a=this.addOsCallQueue(e,t,i);os.notify(a)}catch(s){o=!1}else o=!1;if(!o&&window.os&&window.os[e])if("action"==e)"function"==typeof t&&i.length>1&&i[1]&&(i[1]=JSON.parse(i[1]),i[1].queueId=++this.callQueueId,i[1]=JSON.stringify(i[1]),this.commandQueue.push({id:this.callQueueId,args:i,callback:t})),window.os[e].apply(window.os,i);else{var l=window.os[e].apply(window.os,i);"function"==typeof t&&t(l)}}else"ios"==this.platform&&(null==this.bridge&&(this.bridge=document.createElement("iframe"),this.bridge.setAttribute("style","display:none;"),this.bridge.setAttribute("height","0px"),this.bridge.setAttribute("width","0px"),this.bridge.setAttribute("frameborder","0"),document.documentElement.appendChild(this.bridge)),this.addOsCallQueue(e,t,i))},addOsCallQueue:function(e,t,i){this.callQueueId++;var n={id:this.callQueueId,args:i,callback:t,action:e};if(this.commandQueue.push(n),"android"==this.platform)return this.urlByCommand(n);if(1==this.commandQueue.length){var o=this.commandQueue[0],a=this.urlByCommand(o);this.bridge.src=a}},urlByCommand:function(e){return"app://"+e.action+"?id="+e.id+"&args="+encodeURIComponent(JSON.stringify(e.args?e.args:[]))},delOsCallQueue:function(e,t){for(var i=this.commandQueue.length,n=0;i>n;n++)if(this.commandQueue[n].id==e){if("function"==typeof this.commandQueue[n].callback)try{this.commandQueue[n].callback(t)}catch(o){console.log(o)}this.commandQueue.splice(n,1);break}if("ios"==this.platform&&this.commandQueue.length>0){var a=this.commandQueue[0],s=this.urlByCommand(a);this.bridge.src=s}},hideNavigationBar:function(){this.exec("hideNavigationBar")},exitApp:function(){this.exec("exitApp")},back:function(e){var t="",i="?";for(var n in e)t+=i+encodeURIComponent(n)+"="+encodeURIComponent(e[n]),i="&";window.location.href="app://back"+t},tag:function(e){this.exec("tag",null,e)},setNeedsReload:function(e,t){"string"==typeof t?this.exec("setNeedsReload",null,e,t):this.exec("setNeedsReload",null,e)},onBack:function(e){var t=this.pushCallback(e);t?this.exec("onBack",null,t):this.exec("onBack",null,0)},setTitle:function(e){this.exec("setTitle",null,e)},clipText:function(e,t){this.exec("clipText",t,e)},getClipText:function(e){this.exec("getClipText",e)},openWebView:function(e,t){this.exec("openWebView",null,e,t)},action:function(e,t,i){var n={};if(t&&"object"==typeof t)for(var o in t)n[o]="function"==typeof t[o]?this.pushCallback(t[o]):t[o];this.exec("action",i,e,JSON.stringify(n))},hitEvent:function(e,t){this.exec("hitEvent",null,e,t)},bind:function(e,t){var i=e;e=e.substring(0,1).toUpperCase()+e.substr(1),"function"==typeof t?(this.osEventCallback["on"+e]=t,"android"==this.platform&&window.os&&window.os.registerEvent&&window.os.registerEvent.call(window.os,i)):(delete this.osEventCallback["on"+e],"android"==this.platform&&window.os&&window.os.unregisterEvent&&window.os.unregisterEvent.call(window.os,i))},trigger:function(e){e=e.substring(0,1).toUpperCase()+e.substr(1);var t=null;try{t=this.osEventCallback["on"+e]&&this.osEventCallback["on"+e]()}catch(i){}if("android"!=this.platform)return t;var n=[e];if(null!==t&&void 0!==t){var o=typeof t;n.push("string"==o?t:JSON.stringify(t)),n.push(o)}window.os&&window.os.onReceiveResult&&window.os.onReceiveResult(n[0],n[1],n[2])}};